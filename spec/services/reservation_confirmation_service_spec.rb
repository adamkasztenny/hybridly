require 'rails_helper'

RSpec.describe ReservationConfirmationService do
  let!(:reservation_policy) { create(:reservation_policy) }
  let!(:reservation) { create(:reservation, verification_code: '16c6d2d0-9c87-0139-74f1-78b156e37368') }
  let(:domain) { "hybridly.example.com" }

  # rubocop:disable Layout/LineLength
  let(:expected_qr_code_as_svg) {
    '<?xml version="1.0" standalone="yes"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ev="http://www.w3.org/2001/xml-events" width="539" height="539" shape-rendering="crispEdges"><path d="M0 0h7v7h-7zM8 0h8v2h-1v2h-1v-1h-1v-1h-1v-1h-1v2h1v1h1v1h-2v2h-1v-6h-1v2h-1zM17 0h1v2h-1zM19 0h1v1h-1zM22 0h1v1h-1zM24 0h3v2h-1v-1h-1v1h-1zM28 0h2v1h1v-1h1v4h-1v-2h-1v1h-1v-2h-1zM35 0h1v1h-1zM37 0h1v1h2v-1h1v3h-1v1h-1v-2h-3v-1h1zM42 0h7v7h-7zM1 1v5h5v-5zM33 1h2v1h-2zM43 1v5h5v-5zM2 2h3v3h-3zM35 2h1v1h1v1h1v1h1v3h-1v1h-1v-1h-1v-2h-1v2h-4v-1h-1v-1h1v-1h-1v-1h1v1h1v-1h1v-1h2zM44 2h3v3h-3zM17 3h2v1h-2zM20 3h1v1h-1zM22 3h1v1h2v-1h1v1h1v-1h2v1h-1v1h-1v2h1v-1h1v1h-1v3h-1v1h1v-1h1v3h-2v-1h-1v-3h-4v-3h-1v1h-1v-2h-1v-1h1v1h1v-1h1zM16 4h1v1h-1zM33 4v1h2v-1zM8 5h1v4h-1zM13 5h3v1h-1v1h-1v-1h-1zM17 5h1v1h-1zM23 5v3h3v-3zM12 6h1v1h1v1h-1v1h1v1h-2v-1h-1v-1h1zM16 6h1v1h-1zM18 6h1v1h1v1h-3v-1h1zM24 6h1v1h-1zM31 6v1h1v-1zM33 6v1h1v-1zM37 6v1h1v-1zM40 6h1v2h3v1h1v1h-3v-1h-2v1h-1v-2h1zM15 7h1v2h-1zM2 8h3v1h-3zM6 8h1v1h-1zM20 8h1v1h-1zM29 8h1v1h-1zM35 8h1v1h-1zM46 8h3v1h-3zM0 9h1v2h-1zM9 9h2v1h-2zM16 9h1v1h-1zM18 9h2v1h2v1h1v-1h2v3h-1v-2h-1v1h-1v3h-1v2h-1v6h2v-1h-1v-1h2v-1h-1v-1h1v-1h-1v-1h1v1h1v-2h-2v-1h1v-2h1v2h1v-2h2v1h-1v1h-1v2h1v-2h1v-1h2v1h-2v2h-1v1h-2v1h-1v1h1v-1h4v-1h-1v-1h1v1h1v2h2v1h2v-1h-1v-1h-1v-2h-2v-1h1v-1h1v1h1v-1h2v-1h-1v-1h1v-1h-2v-1h-2v-2h1v1h1v1h1v-2h1v1h2v2h-1v-1h-1v1h1v1h-1v1h1v-1h1v-1h2v1h-1v1h3v1h-1v1h-1v-1h-2v1h-1v-1h-1v1h-1v1h-1v1h1v-1h1v1h-1v1h3v-1h-1v-1h1v-1h2v1h-2v1h1v1h-1v1h-2v1h-1v1h-5v1h1v2h-2v1h1v1h-4v1h1v1h-2v-1h-1v-1h-1v-1h1v-1h-1v-1h-1v2h-1v1h1v1h-2v-2h-1v-1h-1v1h1v1h-2v-1h-1v1h1v2h1v-1h1v1h-1v2h1v-1h2v-1h3v1h-2v1h2v1h-1v1h1v-1h1v-2h1v2h-1v1h1v-1h2v1h-2v1h2v-1h1v-1h1v-1h-3v-1h3v-1h-1v-1h4v-2h-2v-1h2v-1h-1v-1h1v1h2v4h-2v1h-1v1h-1v1h1v-1h2v-1h1v-1h1v2h-2v2h-1v-1h-1v1h1v1h-1v1h-1v1h-1v1h1v-1h4v1h-2v1h-1v-1h-1v1h-2v-1h-1v-1h-1v1h-1v-1h-2v-1h-1v1h-2v-2h1v-1h-1v-1h-2v2h-1v-1h-1v-1h-1v2h-1v-2h-4v-2h-1v-1h-1v-1h-1v1h-1v-1h-1v-3h-1v4h1v1h1v1h-2v-1h-1v-2h-2v-1h1v-1h-1v-4h1v2h2v-1h-1v-1h1v-1h-2v-1h-1v-2h3v1h1v-4h1v-2h-1v-2h1v1h1v-1h1v1h-1v1h1v-1h1v-1h1v1h1v1h1v1h-3v-1h-1v1h-1v1h2v1h-3v2h1v-1h3v2h-2v-1h-1v1h1v1h-3v2h1v-1h2v-1h2v-1h1v-1h1v-2h-2v-1h2v-1h1v1h2v2h2v-2h-1v-1h-1v-1h-2v-1h2v-1h1v1h-1v1h2v-1h1v1h-1v2h1v1h3v-1h-1v-2h1v-1h-1v-1h-1zM2 10h1v2h1v1h-2v1h1v1h-2v1h-1v-2h1v-3h1zM37 10h2v1h-2zM41 10h1v1h1v1h-1v1h-3v-1h1v-1h1zM45 10h2v1h-1v1h-2v-1h1zM48 10h1v3h-1zM17 12h1v1h-1zM20 12v1h1v-1zM31 12h1v1h-1zM43 12h1v1h1v3h-1v-1h-1v-1h-1v-1h1zM46 12h1v1h1v1h1v3h-1v-1h-1v-1h-1zM30 13h1v1h-1zM41 14h1v1h-1zM12 15v1h1v-1zM42 15h1v1h-1zM17 16v1h-2v1h-2v-1h-2v1h2v1h-1v1h-1v-1h-1v1h-1v1h-1v1h1v1h1v1h1v1h1v-1h3v-1h1v-1h1v-1h2v-1h-2v-1h-2v-1h2v-1h1v-1zM40 16h1v1h-1zM43 16h1v1h-1zM46 16h1v2h-1v1h-1v1h-1v1h-1v-1h-1v-1h1v-1h-2v-1h2v1h1v-1h2zM17 18v1h2v-1zM39 18h2v1h-2zM47 18h2v3h-1v-2h-1zM13 19h2v2h-2v1h-1v1h-1v-1h-1v-2h1v1h1v-1h1zM37 19h2v1h-2zM24 20v1h-1v1h1v-1h1v1h1v-2zM36 20h1v1h-1zM40 20h1v1h-1zM46 20h1v2h-1zM5 21v1h2v-1zM35 21h1v1h-1zM37 21h1v1h1v-1h1v1h1v-1h2v1h1v-1h1v1h1v1h-1v1h2v-2h2v2h-1v1h-3v1h1v1h-12v-1h1v-3h-2v-1h2v1h1v-1h1zM17 22v1h-1v1h1v-1h1v-1zM5 23v3h3v-3zM23 23v3h3v-3zM36 23v1h1v-1zM39 23v1h1v-1zM41 23v3h3v-3zM1 24v1h1v-1zM6 24h1v1h-1zM17 24v1h2v-1zM24 24h1v1h-1zM42 24h1v1h-1zM31 25v1h1v-1zM38 25v1h1v-1zM10 26v1h1v-1zM12 26v1h-1v1h-2v-1h-1v1h1v1h1v1h1v-1h1v-2h1v-1zM48 26h1v2h-1zM0 28h1v1h1v2h-1v1h-1zM6 28h1v1h-1zM13 28v1h-1v1h2v-2zM35 28h3v1h-3zM39 28h2v1h1v-1h5v2h-1v-1h-2v3h1v-1h1v1h-1v1h-2v-2h-2v-1h-1v-1h-1zM7 29h1v1h-1zM42 29v1h1v-1zM6 30h1v1h-1zM34 30h2v1h1v-1h3v1h-3v3h3v1h-2v2h-4v-1h3v-1h-1v-1h-1v-1h1v-1h-2zM47 30h2v3h-1v1h-1v-1h-1v-1h2v-1h-1zM4 31h2v1h1v-1h1v1h1v2h-1v-1h-2v1h2v1h-2v1h1v1h-2v-5h-1zM28 32v1h1v-1zM39 32h3v1h-3zM10 33h1v1h-1zM12 33h1v1h-1zM15 33h1v1h-1zM31 33h1v1h-1zM33 33h1v1h-1zM45 33h1v1h-1zM0 34h1v2h-1zM2 34h1v1h-1zM9 34h1v1h1v-1h1v2h-1v1h-1v-1h-2v-1h1zM34 34h1v1h-1zM41 34h3v1h2v1h2v-2h1v3h-5v-1h-1v-1h-1v1h-1v2h-1v-1h-1v-1h1v-1h1zM3 35h1v2h1v1h-2zM16 35h2v1h-2zM1 36h1v1h-1zM12 36h4v2h1v1h1v-1h1v1h-1v1h3v1h-2v1h-1v-1h-2v3h-1v-4h-1v-1h-1v5h-1v-1h-1v1h-1v-2h-2v-4h-1v-1h1v1h3v-1h1zM20 36h1v1h-1zM22 36h2v1h1v-1h1v1h-1v1h-1v2h3v-1h-1v-1h2v2h-1v4h3v-1h-1v-1h1v-1h-1v-3h1v2h1v-1h2v1h-2v1h2v-1h1v-2h-3v-1h3v1h5v2h1v-1h2v-2h2v2h-2v1h2v-1h1v-1h4v1h-4v1h4v1h-1v1h1v2h-1v1h-3v1h-1v-1h-3v1h-2v-1h1v-1h-2v-1h1v-1h-2v1h-1v-1h-2v-1h-1v1h-1v1h-1v-1h-1v1h1v1h1v-1h1v-1h1v2h-2v1h-1v1h-1v2h-1v-2h-1v-1h-1v1h1v2h-1v-1h-2v-1h-1v-1h-3v-3h1v-2h1v-2h-1zM13 37v1h2v-1zM1 38h1v1h2v1h-1v1h-3v-1h1zM5 38h2v1h-2zM20 38h1v1h-1zM10 39v1h-1v1h1v-1h1v-1zM36 39v1h-1v1h1v-1h1v-1zM6 40h1v1h-1zM11 40v1h-1v1h1v-1h1v-1zM37 40v1h1v-1zM23 41v3h3v-3zM39 41v1h1v-1zM41 41v3h3v-3zM0 42h7v7h-7zM17 42h1v1h-1zM24 42h1v1h-1zM42 42h1v1h-1zM45 42v2h2v-2zM1 43v5h5v-5zM18 43h2v1h-1v1h-1zM2 44h3v3h-3zM8 44h1v2h1v-1h1v-1h1v1h1v-1h2v1h3v2h-1v-1h-2v1h-1v1h-1v-2h-1v1h-1v2h-2v-1h1v-1h-2zM35 44h3v1h-3zM19 45h2v2h2v1h-1v1h-1v-1h-1v1h-1v-1h-1v-1h2v-1h-1zM25 45v1h1v-1zM32 45h1v1h-1zM48 45h1v4h-5v-1h-3v-1h1v-1h2v2h1v-1h1v1h2v-1h-1v-1h1zM33 46h4v1h-3v1h3v1h-4v-1h-1v1h-1v-2h2zM38 46h1v1h-1zM15 47h1v1h1v1h-3v-1h1zM24 47h1v1h1v1h-2zM12 48h1v1h-1zM38 48h3v1h-3z" style="fill:#000" transform="translate(0,0) scale(11)"/></svg>'
  }
  # rubocop:enable Layout/LineLength

  it "creates a QR code as SVG with a link to the reservation confirmation URL" do
    qr_code = ReservationConfirmationService.create_qr_code(reservation, domain)

    expect(qr_code).to eq(expected_qr_code_as_svg)
  end
end
