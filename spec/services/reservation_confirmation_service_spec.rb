require 'rails_helper'

RSpec.describe ReservationConfirmationService do
  let!(:reservation_policy) { create(:reservation_policy) }
  let!(:reservation) { create(:reservation, verification_code: '16c6d2d0-9c87-0139-74f1-78b156e37368') }

  # rubocop:disable Layout/LineLength
  let(:expected_qr_code_as_svg) {
    '<?xml version="1.0" standalone="yes"?><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ev="http://www.w3.org/2001/xml-events" width="451" height="451" shape-rendering="crispEdges"><path d="M0 0h7v7h-7zM10 0h3v7h-1v-1h-1v-2h-1v2h-1v-2h-1v-2h1v-1h1zM15 0h1v1h1v-1h1v1h1v-1h1v1h-1v1h-5v-1h1zM21 0h1v1h3v1h-3v1h-1v-1h-1v-1h1zM28 0h2v1h-1v1h-1zM32 0h1v1h-1zM34 0h7v7h-7zM1 1v5h5v-5zM11 1v1h1v-1zM31 1h1v1h1v1h-1v1h1v3h-1v-2h-1zM35 1v5h5v-5zM2 2h3v3h-3zM9 2v1h1v-1zM19 2h1v1h1v1h1v-1h3v5h-1v1h1v-1h1v-4h1v5h1v-3h1v-3h1v3h-1v2h1v-2h1v1h1v1h-2v1h2v-1h1v1h-1v1h-1v1h-1v1h-1v1h-4v-1h-1v1h1v1h-3v-1h-1v1h-1v2h-1v-4h-2v1h-1v1h-1v-2h-2v-2h1v-1h-2v3h-2v2h-2v-1h-5v-1h1v-1h-2v-1h-1v1h-1v-2h3v-1h2v1h1v-1h2v1h-2v1h1v1h-2v-1h-1v1h1v1h2v-1h1v-2h1v-1h2v-1h-1v-1h1v1h1v1h2v-3h2v-1h-1v-1h1v1h1v-1h2zM27 2h1v1h-1zM36 2h3v3h-3zM17 4v1h1v1h-1v1h-1v-1h-1v2h1v1h-1v1h-1v1h1v-1h1v-1h1v1h-1v1h-1v1h1v-1h2v-2h1v-1h1v-2h-1v-1h1v-1zM22 4v1h1v2h-1v-1h-1v1h1v1h1v-1h1v-3zM8 6h1v1h-1zM18 6h1v1h-1zM17 7h1v1h-1zM37 8h2v1h-1v3h-2v-1h1v-1h-1v-1h1zM19 9v1h1v-1zM22 9v2h-1v-1h-1v2h2v-1h4v-1h-3v-1zM33 9h1v1h-1zM39 9h1v2h1v5h-1v2h1v1h-1v1h1v1h-2v1h-1v-2h-2v-1h3v-3h-3v1h-1v-1h-2v-1h1v-1h-1v-1h-2v-1h4v3h1v-2h1v1h1v-1h2v-1h-1zM9 10v1h-1v1h1v-1h2v-1zM0 12h1v1h-1zM12 12h1v1h-1zM22 12v1h1v-1zM11 13h1v1h-1zM13 13h1v2h-2v-1h1zM17 13h1v2h-1v2h1v-1h1v1h-1v1h-1v1h-1v-2h-1v-2h1v-1h1zM30 13h1v1h-1zM0 14h2v1h1v-1h2v2h2v-1h-1v-1h1v1h1v1h-1v1h-1v1h-1v-1h-2v1h-2v-2h-1zM10 14h1v2h-1zM21 14h1v1h-1zM25 14h1v1h-1zM27 14h1v1h-1zM29 14h1v1h-1zM31 14h1v2h-1zM22 15h3v1h1v-1h1v2h1v-2h1v2h1v-1h1v1h-1v1h-2v1h-3v2h-2v-3h-2v-1h-1v-1h1v1h1zM11 16h1v1h-1zM23 16v2h3v-1h-2v-1zM32 16h1v1h-1zM7 17h1v4h-3v-1h2v-1h-1v-1h1zM9 17h2v2h1v-1h1v-1h2v3h-2v-1h-1v1h-2v1h-1v-2h1v-1h-1zM31 17h1v2h1v-2h1v1h1v2h1v1h-2v-2h-1v1h-1v1h1v2h-1v-1h-1v1h-1v1h-1v-1h-1v2h1v1h1v-1h1v-1h2v1h-2v1h1v2h-1v-1h-3v1h-1v-4h-1v-1h-1v-2h1v-1h4v-2h1zM36 17h1v1h-1zM0 18h1v2h1v-1h1v1h-1v1h-1v1h1v-1h2v1h-2v1h2v1h1v-2h2v1h-1v1h1v1h-2v1h2v-1h1v-4h1v1h1v1h2v1h-1v1h-1v-1h-1v1h-1v1h-1v1h-3v-1h-1v-2h-1v2h-1v-1h-1zM4 18h1v1h-1zM18 18h2v2h-1v3h-1v-1h-2v-1h-1v-1h1v1h2zM21 19h1v2h-1zM12 20h1v1h1v1h1v2h-2v-2h-1zM30 20v1h1v-1zM22 21h1v1h-1zM26 21v2h1v-2zM36 21h1v1h-1zM37 22h1v1h-1zM39 22h1v1h1v1h-1v1h-1zM16 23h1v1h-1zM19 23h2v1h-2zM22 23h3v2h1v4h-1v-3h-4v-1h1zM34 23h3v1h-2v2h-1zM12 24h1v2h-1v1h1v-1h2v-1h2v2h1v-3h1v3h1v-1h1v1h-1v1h2v1h1v-2h1v2h1v3h-1v-2h-3v1h-1v1h-4v-2h-1v-1h1v-1h-1v-1h-2v1h-4v1h-3v-1h1v-1h1v-1h1v-1h1v2h1v-2h1zM23 24v1h1v-1zM36 25h3v3h-2v-1h-1v2h-1v-1h-1v-1h-1v-1h1v1h1v-1h1zM40 25h1v2h-1zM0 26h1v1h-1zM1 27h1v1h-1zM3 27h1v1h-1zM0 28h1v2h1v-2h1v1h1v-1h1v1h-1v1h-2v1h2v-1h1v1h-1v1h-2v1h-2zM17 28v1h1v-1zM28 28h1v1h-1zM30 28h1v1h-1zM33 28h1v1h-1zM10 29h2v1h-1v2h-1v2h-1v1h-1v-2h-2v-1h1v-1h-1v-1h2v1h2zM18 29v1h-1v1h2v-2zM26 29h2v1h3v-1h2v1h-1v1h-1v1h-1v-1h-1v1h-1v1h1v-1h1v1h2v-1h2v-1h-1v-1h3v-1h1v1h-1v1h3v-2h1v1h1v1h-2v1h2v1h-1v3h-1v-1h-2v1h1v1h-2v1h1v2h1v-3h3v3h-1v-1h-1v1h-1v1h-2v-1h-2v1h-2v-1h-1v-1h1v1h1v-1h2v-2h-1v1h-1v-1h-1v1h-2v1h-1v1h-1v-1h-1v-2h-2v1h-1v-1h-2v-1h-1v-1h-1v-1h-1v1h-1v1h-1v-1h-1v-1h-1v1h-1v-1h-1v-1h-2v-1h2v1h2v-1h1v1h1v1h1v-1h2v1h1v1h1v1h1v-2h-1v-1h-1v-1h1v-1h1v1h1v1h-1v1h1v-1h1v-1h1v1h-1v1h-1v1h1v-1h1v-1h1v-2h-1zM12 30h2v1h-2zM8 32v1h1v-1zM37 32v2h2v-1h-1v-1zM33 33v3h3v-3zM0 34h7v7h-7zM11 34h1v3h5v1h2v-1h-1v-1h1v-1h1v1h1v3h-1v2h-2v-1h-1v-1h-1v-1h-2v1h-1v1h-3v1h-1v-3h-1v-2h1v-1h1v2h-1v1h1v1h1zM26 34v1h-1v1h1v-1h1v-1zM28 34v1h1v-1zM34 34h1v1h-1zM1 35v5h5v-5zM15 35h1v1h-1zM30 35v1h-2v2h1v-1h2v-1h1v-1zM2 36h3v3h-3zM14 39h1v1h-1zM18 39v1h1v-1zM24 39h1v1h-1zM26 39h1v1h-1zM13 40h1v1h-1zM21 40h3v1h-3zM25 40h1v1h-1z" style="fill:#000" transform="translate(0,0) scale(11)"/></svg>'
  }
  # rubocop:enable Layout/LineLength

  it "creates a QR code as SVG with a link to the reservation confirmation URL" do
    qr_code = ReservationConfirmationService.create_qr_code(reservation)

    expect(qr_code).to eq(expected_qr_code_as_svg)
  end
end
